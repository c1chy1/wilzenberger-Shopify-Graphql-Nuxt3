import { defineNuxtPlugin, loadPayload, isPrerendered, useRouter } from "#app";
export default defineNuxtPlugin((nuxtApp) => {
  if (!isPrerendered()) {
    return;
  }
  nuxtApp.hooks.hook("link:prefetch", (to) => loadPayload(to));
  useRouter().beforeResolve(async (to, from) => {
    if (to.path === from.path) {
      return;
    }
    const payload = await loadPayload(to.path);
    if (!payload) {
      return;
    }
    Object.assign(nuxtApp.payload.data, payload.data);
  });
});
